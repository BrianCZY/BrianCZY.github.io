

Android系统内置无源码的apk

1、在alps/packages/apps 目录下创建一个自己的目录比如 MyApps，

1、在alps/packages/apps 目录下创建一个自己的目录比如 MyApps，

2、将apk 放到这个目录上，比如拷贝搜狗输入 SogouInput_android_v8.35_sweb.apk 到 MyApps上，

3、在MyApps目录上创建Android.mk文件

​	Android.mk文件的内容如下：

```mk
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

# Module name should match apk name to be installed
LOCAL_MODULE := SogouInput_android_v8.35_sweb
LOCAL_MODULE_TAGS := optional
LOCAL_SRC_FILES := $(LOCAL_MODULE).apk
LOCAL_MODULE_CLASS := APPS
LOCAL_MODULE_SUFFIX := $(COMMON_ANDROID_PACKAGE_SUFFIX)
LOCAL_MODULE_PATH := $(TARGET_OUT)/app
LOCAL_CERTIFICATE := PRESIGNED
include $(BUILD_PREBUILT)

```



修改文 build/target/product/${Project}.mk  ，其中Project是编译对应的版本，比如我修改的是core_base.mk

~/phone/mtk/kt109/alps/build/target/product$ vim core_base.mk

PRODUCT_PACKAGES   中 ，添加SogouInput_android_v8.35_sweb，SogouInput_android_v8.35_sweb对应的是Android.mk中的LOCAL_MODULE

```m

PRODUCT_PACKAGES += \
SogouInput_android_v8.35_sweb\
ContactsProvider \

```

此时添加完成，重新编译系统或编译模块即可。





问题：

mmm  编译的时候报错

```

make: *** [out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex] Error 1
make: *** Deleting file `out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex'
make: Leaving directory `/home/ubuntu/phone/mtk/kt109/alps'

#### make failed to build some targets (4 seconds) ####

```



添加：

Android.mk中添加

LOCAL_PRIVILEGED_MODULE := false



```mak
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

# Module name should match apk name to be installed
LOCAL_MODULE := FenoMeasure
LOCAL_MODULE_TAGS := optional
LOCAL_SRC_FILES := $(LOCAL_MODULE).apk
LOCAL_MODULE_CLASS := APPS
LOCAL_MODULE_SUFFIX := $(COMMON_ANDROID_PACKAGE_SUFFIX)
LOCAL_MODULE_PATH := $(TARGET_OUT)/app
LOCAL_CERTIFICATE := PRESIGNED
LOCAL_PRIVILEGED_MODULE := false
include $(BUILD_PREBUILT)

```



报错

```
dex2oatd F 18523 18526 art/runtime/runtime_linux.cc:313] Fault message:
make: *** [out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex] Aborted (core dumped)
make: *** Deleting file `out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex'
make: Leaving directory `/home/ubuntu/phone/mtk/kt109/alps'

```



Android.mk中添加

```
LOCAL_DEX_PREOPT=false
```

