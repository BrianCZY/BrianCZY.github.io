

Android系统内置无源码的apk

1、在alps/packages/apps 目录下创建一个自己的目录比如 MyApps，

1、在alps/packages/apps 目录下创建一个自己的目录比如 MyApps，

2、将apk 放到这个目录上，比如拷贝搜狗输入 SogouInput_android_v8.35_sweb.apk 到 MyApps上，

3、在MyApps目录上创建Android.mk文件

​	Android.mk文件的内容如下：

```mk
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

# Module name should match apk name to be installed
LOCAL_MODULE := SogouInput_android_v8.35_sweb
LOCAL_MODULE_TAGS := optional
LOCAL_SRC_FILES := $(LOCAL_MODULE).apk
LOCAL_MODULE_CLASS := APPS
LOCAL_MODULE_SUFFIX := $(COMMON_ANDROID_PACKAGE_SUFFIX)
LOCAL_MODULE_PATH := $(TARGET_OUT)/app
LOCAL_CERTIFICATE := PRESIGNED
include $(BUILD_PREBUILT)

```



修改文 build/target/product/${Project}.mk  ，其中Project是编译对应的版本，比如我修改的是core_base.mk

~/phone/mtk/kt109/alps/build/target/product$ vim core_base.mk

PRODUCT_PACKAGES   中 ，添加SogouInput_android_v8.35_sweb，SogouInput_android_v8.35_sweb对应的是Android.mk中的LOCAL_MODULE

```m

PRODUCT_PACKAGES += \
SogouInput_android_v8.35_sweb\
ContactsProvider \

```

此时添加完成，重新编译系统或编译模块即可。





问题：

mmm  编译的时候报错

```

make: *** [out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex] Error 1
make: *** Deleting file `out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex'
make: Leaving directory `/home/ubuntu/phone/mtk/kt109/alps'

#### make failed to build some targets (4 seconds) ####

```



添加：

Android.mk中添加

LOCAL_PRIVILEGED_MODULE := false



```mak
LOCAL_PATH:= $(call my-dir)
include $(CLEAR_VARS)

# Module name should match apk name to be installed
LOCAL_MODULE := FenoMeasure
LOCAL_MODULE_TAGS := optional
LOCAL_SRC_FILES := $(LOCAL_MODULE).apk
LOCAL_MODULE_CLASS := APPS
LOCAL_MODULE_SUFFIX := $(COMMON_ANDROID_PACKAGE_SUFFIX)
LOCAL_MODULE_PATH := $(TARGET_OUT)/app
LOCAL_CERTIFICATE := PRESIGNED
LOCAL_PRIVILEGED_MODULE := false
include $(BUILD_PREBUILT)

```



报错

```
dex2oatd F 18523 18526 art/runtime/runtime_linux.cc:313] Fault message:
make: *** [out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex] Aborted (core dumped)
make: *** Deleting file `out/target/product/kt109_feinuo/obj/APPS/FenoMeasure_intermediates/arm64/package.odex'
make: Leaving directory `/home/ubuntu/phone/mtk/kt109/alps'

```



Android.mk中添加

```
LOCAL_DEX_PREOPT=false
```

------------------------------------------------------------------------------------------------------------------------







在vendor目录下创建MyApps目录，并拷贝app到MyApps目录上

添加Android.mk，内容如下：

```
  1 LOCAL_PATH:= $(call my-dir)
  2      include $(CLEAR_VARS)
  3     LOCAL_MODULE := SogouInput
  4 $(shell mkdir -p $(PRODUCT_OUT)/vendor/MyApps/$(LOCAL_MODULE))
  5 $(shell mkdir -p $(TARGET_OUT)/preloadApp/$(LOCAL_MODULE))
  6 $(shell cp $(LOCAL_PATH)/$(LOCAL_MODULE).apk $(PRODUCT_OUT)/vendor/MyApps/$(LOCAL_MODULE)/$(LOCAL_MODULE).apk)
  7 $(shell cp $(LOCAL_PATH)/$(LOCAL_MODULE).apk $(TARGET_OUT)/preloadApp/$(LOCAL_MODULE)/$(LOCAL_MODULE).apk)
  8 #$(shell mkdir -p $(TARGET_OUT)/preloadApp/$(LOCAL_MODULE))
  9 # $(shell cp -rf $(LOCAL_PATH)/SogouInput.apk $(PRODUCT_OUT)/vendor/)
 10 #   $(shell cp -rf $(LOCAL_PATH)/SogouInput.apk $(PRODUCT_OUT)/vendor/MyApps/)
 11 #   $(shell cp -rf $(LOCAL_PATH)/$(LOCAL_MODULE).apk $(PRODUCT_OUT)/vendor/MyApps/$(LOCAL_MODULE)/$(LOCAL_MODULE).apk)
 12





```



### 6、修改init.project.rc文件   不必

```
 ubuntu@ubuntu-Pc:~/phone/mtk/kt109/alps$ vim device/lentek/kt109_feinuo/init.project.rc
```

在on post-fs-data 下添加以下代码：

```
109 #MyApps
110
111     mkdir /vendor/MyApps 0777 system system

```





7、\frameworks\base\services\core\java\com\android\server\pm